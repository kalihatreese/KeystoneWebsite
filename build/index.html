<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Keystone Core</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; background: #000510; color: #00ffff; font-family: 'Courier New', monospace; overflow: hidden; }
        canvas { display: block; position: fixed; top: 0; left: 0; z-index: 1; }
        #interface { position: relative; z-index: 2; padding: 20px; pointer-events: none; height: 100vh; display: flex; flex-direction: column; justify-content: space-between; }
        .terminal-box { background: rgba(0,10,30,0.85); border: 1px solid #00ffff; padding: 15px; pointer-events: auto; box-shadow: 0 0 15px rgba(0,255,255,0.2); }
        #status { font-size: 10px; color: #5588aa; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>
    <div id="interface">
        <div class="terminal-box" id="voice-display">SYSTEM STANDBY: TAP TO INITIALIZE TRINITY</div>
        <div id="status">Veritas v1.0 // D1 Synced // Edge Active</div>
    </div>

    <script>
        let scene, camera, renderer, core;

        function startEngine() {
            // Scene Setup
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.z = 4;

            // Mobile-Optimized Renderer
            renderer = new THREE.WebGLRenderer({ antialias: false, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.body.appendChild(renderer.domElement);

            // The 'Keystone' Wireframe
            const geo = new THREE.OctahedronGeometry(1.5, 0);
            const mat = new THREE.MeshBasicMaterial({ color: 0x00ffff, wireframe: true });
            core = new THREE.Mesh(geo, mat);
            scene.add(core);

            // Particles
            const pGeo = new THREE.BufferGeometry();
            const pCount = 500;
            const pos = new Float32Array(pCount * 3);
            for(let i=0; i<pCount*3; i++) pos[i] = (Math.random()-0.5) * 10;
            pGeo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const pMat = new THREE.PointsMaterial({ color: 0x0088ff, size: 0.02 });
            scene.add(new THREE.Points(pGeo, pMat));

            animate();
            fetchBrainData();
        }

        async function fetchBrainData() {
            const display = document.getElementById('voice-display');
            display.innerText = "ACCESSING D1 MEMORY BANKS...";
            try {
                const res = await fetch('/api/memory');
                const data = await res.json();
                display.innerText = "VERITAS: " + (data.content || "Memory initialized.");
            } catch (e) {
                display.innerText = "VERITAS: Edge connection secure. Standing by.";
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            core.rotation.y += 0.01;
            core.rotation.x += 0.005;
            renderer.render(scene, camera);
        }

        // Tap to Wake
        window.addEventListener('click', () => {
            if(!scene) startEngine();
        }, {once: true});

        window.addEventListener('resize', () => {
            if(!camera) return;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
